import random
"""
different from version 1 in that it stops invalid inputs
different from version 2 in that it allows you to choose the grid size and number of mines
different from version 3 in that it allows you to place flags where you think mines are hiding

if you're looking at a spot x and the spots around it, the directions are

123
8x4
765
"""

def isInRange(minRange, maxRange, phrase):
    """checks if input given from user is an integer and fits the range it's supposed to be in"""
    correct = False
    var = 0
    while(correct == False):
        var = raw_input(phrase)
        try:
            int(var)
        except ValueError:
            print "Try again"
        else:
            var = int(var)
            if (var >= minRange and var <= maxRange):
                correct = True
            else:
                print "Try again"
    return var

WIDTH = isInRange(5, 20, "What width do you want the grid to be? ")
HEIGHT = isInRange(5, 20, "What height do you want the grid to be? ")
minDim = min(WIDTH, HEIGHT)
maxDim = max(WIDTH, HEIGHT)
MINES = isInRange(minDim, maxDim, "How many mines do you want the grid to have? No fewer than " + str(minDim) + " or more than " + str(maxDim) + ": ")
"""grid will be HEIGHT x WIDTH"""

def returnGrid(grid):
    """if you ever need to use the grid it can be returned as a string"""
    result = ""
    for row in range (len(grid)):
        result += str(grid[row])
    return result
def printGrid(grid):
    """prints the grid as a matrix"""
    for row in range(len(grid)):
        print str(grid[row])

grid = [[0 for j in range(WIDTH)] for i in range(HEIGHT)]
"""the grid will store data that isn't seen such as mine location"""
game = [["-" for j in range(WIDTH)] for i in range(HEIGHT)]
"""game will store data about what the player sees such as spots they've already checked"""

for mine in range(MINES):
    """puts the mines in random places on the grid and marks them with an X"""
    y_var = random.randint(0, WIDTH - 1)
    x_var = random.randint(0, HEIGHT - 1)
    grid[x_var][y_var] = "X"

def whichDirections(r, c):
    """based on where in the grid the spot is, this will return a list of which directions to check
    for example if you're in the top left corner, you can't check something in the 1 direction because
    that would be row -1"""
    results = []
    if r == 0:
        if c == 0:
            results = [4, 5, 6]
        elif c == WIDTH - 1:
            results = [6, 7, 8]
        else:
            results = [4, 5, 6, 7, 8]
    elif r == HEIGHT - 1:
        if c == 0:
            results = [2, 3, 4]
        elif c == WIDTH - 1:
            results = [1, 2, 8]
        else:
            results = [1, 2, 3, 4, 8]
    else:
        if c == 0:
            results = [2, 3, 4, 5, 6]
        elif c == WIDTH - 1:
            results = [1, 2, 6, 7, 8]
        else:
            results = [1, 2, 3, 4, 5, 6, 7, 8]
    return results

def checkMines(direction_list, r, c):
    """takes in a list of which directions are valid for the spot [r][c]
    calculates how many mines surround the spot and returns it"""
    total = 0
    for num in direction_list:
        if (num == 1 and grid[r-1][c-1] == "X"):
            total += 1
        elif (num == 2 and grid[r-1][c] == "X"):
            total += 1
        elif (num == 3 and grid[r-1][c+1] == "X"):
            total += 1
        elif (num == 4 and grid[r][c+1] == "X"):
            total += 1
        elif (num == 5 and grid[r+1][c+1] == "X"):
            total += 1
        elif (num == 6 and grid[r+1][c] == "X"):
            total += 1
        elif (num == 7 and grid[r+1][c-1] == "X"):
            total += 1
        elif (num == 8 and grid[r][c-1] == "X"):
            total +=1
    return total

for r in range(HEIGHT):
    for c in range(WIDTH):
        """takes every spot on the grid, if it's not a mine, and changes it's
        character representation from a dash to the number of mines that surround it"""
        if grid[r][c] != "X":
            directions = whichDirections(r, c)
            grid[r][c] = str(checkMines(directions, r, c))

printGrid(game)
win = False
lose = False
spotsOpen = WIDTH*HEIGHT
flagsPlaced = 0
"""if you're starting with a 10x10 grid, there are 100 spots of which 10 are mines
after every new spot is opened by the player, the spot count decreases
once there are only 10 spots left, the player has found all the mines and wins"""
while(win == False and lose == False):
    """the next two checks will make sure the input given is actually an integer 1-10
    if not it will keep asking for input again"""
    y_var = isInRange(0, WIDTH, "Which column 1-" + str(WIDTH) + ": ") - 1
    x_var = isInRange(0, HEIGHT, "Which row 1-" + str(HEIGHT) + ": ") - 1
    """subtract one because the lists are in the order 0-HEIGHT/WIDTH, they don't start at index 1"""
    toFlag = raw_input("Do you want to flag/unflag this spot as a mine, or click? Anything other than 'flag' will mean click: ")
    if(game[x_var][y_var] == "-"):
        if (toFlag != "flag"):
            spotsOpen -= 1
            """if the spot the player enters has not already been revealed, the spot count decreases"""
            game[x_var][y_var] = grid[x_var][y_var]
            if(grid[x_var][y_var] == "X"):
                """if the spot chosen is a mine, the player loses"""
                printGrid(game)
                print
                print "Game over"
                lose = True
        else:
            """you're flagging it as a mine"""
            game[x_var][y_var] = "F"
            flagsPlaced += 1
    elif(game[x_var][y_var] == "F"):
        if (toFlag == "flag"):
            """removing flag"""
            game[x_var][y_var] = "-"
            flagsPlaced -= 1
        else:
            print "You cannot click a flagged spot"
    if game[x_var][y_var] == "0":
        game[x_var][y_var] = grid[x_var][y_var]
        """if the spot chosen has 0 mines around it, then all the spots around it will be revealed"""
        placeZero = whichDirections(x_var, y_var)
        for num in placeZero:
            r = x_var
            c = y_var
            """some of the spots around the 0 might have already been revealed, so they do not need to be re-revealed
            and the spot count should not decrease if they have already been revealed"""
            if (num == 1 and game[r-1][c-1] == "-"):
                game[r-1][c-1] = grid[r-1][c-1]
                spotsOpen -= 1
            elif (num == 2 and game[r-1][c] == "-"):
                game[r-1][c] = grid[r-1][c]
                spotsOpen -= 1
            elif (num == 3 and game[r-1][c+1] == "-"):
                game[r-1][c+1] = grid[r-1][c+1]
                spotsOpen -= 1
            elif (num == 4 and game[r][c+1] == "-"):
                game[r][c+1] = grid[r][c+1]
                spotsOpen -= 1
            elif (num == 5 and game[r+1][c+1] == "-"):
                game[r+1][c+1] = grid [r+1][c+1]
                spotsOpen -= 1
            elif (num == 6 and game[r+1][c] == "-"):
                game[r+1][c] = grid[r+1][c]
                spotsOpen -= 1
            elif (num == 7 and game[r+1][c-1] == "-"):
                game[r+1][c-1] = grid[r+1][c-1]
                spotsOpen -= 1
            elif (num == 8 and game[r][c-1] == "-"):
                game[r][c-1] = grid[r][c-1]
                spotsOpen -= 1
        printGrid(game)
    else:
        printGrid(game)
    if spotsOpen == MINES:
        """if the only spots left are the mines, the player wins"""
        print
        print "You win!"
        win = True
    else:
        print "Flags placed = " + str(flagsPlaced)
        print
print "The grid was: "
printGrid(grid)
